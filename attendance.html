<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance</title>
    <style>
        :root {
            --primary-color: #007BFF;
            --secondary-color: #f9f9f9;
            --font-color: #333;
            --border-radius: 8px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--secondary-color);
            color: var(--font-color);
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        #content {
            margin-top: 20px;
            font-size: 1rem;
        }

        .greeting {
            font-size: 1.5rem;
            font-weight: 600;
            color:#ff6347;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Loader Styles */
        .loader {
            border: 4px solid #f3f3f3; /* Light gray */
            border-top: 4px solid var(--primary-color); /* Blue color */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            overflow: hidden;
            background: #fff;
        }

        th, td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: var(--primary-color);
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
        }

        td:nth-child(even) {
            background: #f2f2f2;
        }

        td {
            background: #fff;
            font-size: 0.95rem;
        }

        button {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #0056b3;
        }

        .hidden {
            display: none;
        }

        /* Style for button group */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

      /* Footer styling */



.greeting-text {
    color: black; /* Black color for the greeting */
    font-size: 1.5rem;
    font-weight: 600;
}

.name-text {
    color: #ff6347; /* Black color for the name */
    font-size: 1.8rem;
    font-weight: 700;
    font-family: inherit; /* Use the default font of the page */
}
/* Date and Time Styles */
    .date-time {
        position: fixed;
        top: 5px;
        right: 10px;
        font-size: 1.5rem;
        color: black;
        font-family: inherit;
        z-index: 10;
    }


    </style>
</head>
<body>
    <div id="greeting" class="greeting">Loading...</div> <!-- Greeting will appear here -->
    <div id="content">
        <div class="loader"></div> <!-- Loader will appear here while fetching data -->
    </div>

    <div class="button-group">
        <button id="backButton" class="hidden" onclick="goBack()">Go Back</button>
        <button id="cieButton" class="hidden" onclick="goToCIE()">Show CIE Marks</button>
    </div>




    <script>
    
        function goBack() {
            window.location.href = 'index.html';
        }

        function goToCIE() {
            window.location.href = 'cie.html';  // Redirect to the CIE page
        }

     async function fetchName() {
    const mobileNumber = localStorage.getItem('mobileNumber');
    if (!mobileNumber) return;

    try {
        const response = await fetch(`https://nam969.89determined.workers.dev/?mobile_number=${mobileNumber}`);
        if (!response.ok) {
            throw new Error('Failed to fetch name');
        }
        const name = await response.text();
        displayGreeting(name);
    } catch (error) {
        console.error("Error fetching name:", error);
        // Display the specific error message
        const contentDiv = document.getElementById('content');
        contentDiv.innerHTML = "<p>Incorrect Number, Go back and enter your parent's number.</p>";
        
        // Show the Go Back button
        const backButton = document.getElementById('backButton');
        backButton.classList.remove('hidden');
    }
}


        // Display the greeting based on the time of day
    function displayGreeting(name) {
    const greetingDiv = document.getElementById('greeting');
    const currentHour = new Date().getHours();
    let greeting = "Good Day";

    if (currentHour < 12) {
        greeting = `Good Morning, ${name}`;
    } else if (currentHour < 17) {
        greeting = `Good Afternoon, ${name}`;
    } else if (currentHour < 21) {
        greeting = `Good Evening, ${name}`;
    } else {
        greeting = `Good Night, ${name}`;
    }

    // Use the greeting with the comma explicitly included
    greetingDiv.innerHTML = `<span class="greeting-text">${greeting.split(',')[0]},</span><br><span class="name-text">${greeting.split(',')[1]}</span>`;

    // Add greeting and name with different colors
    greetingDiv.innerHTML = `<span class="greeting-text">${greetingText}</span><br><span class="name-text">${nameText}</span>`;
}



        // Fetch attendance data
        async function fetchAttendance() {
            const mobileNumber = localStorage.getItem('mobileNumber');
            const contentDiv = document.getElementById('content');
            const backButton = document.getElementById('backButton');
            const cieButton = document.getElementById('cieButton');

            // Hide buttons while loading
            backButton.classList.add('hidden');
            cieButton.classList.add('hidden');

            if (!mobileNumber) {
                contentDiv.innerHTML = "<p>No mobile number found.</p>";
                backButton.classList.remove('hidden'); // Show the button
                return;
            }

            try {
                const response = await fetch(`https://sanjaya969.89determined.workers.dev?mobile_number=${mobileNumber}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const rawHtml = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(rawHtml, "text/html");

                const overallElement = doc.querySelector("h4 strong");
                const overallAttendance = overallElement?.nextSibling?.nodeValue.trim() || "N/A";

                const listItems = doc.querySelectorAll("ul li");
                const subjects = Array.from(listItems).map(li => {
                    const subject = li.querySelector("strong")?.textContent || "Unknown";
                    const attendance = li.childNodes[1]?.nodeValue?.trim() || "N/A";
                    return { subject, attendance };
                });

                contentDiv.innerHTML = ''; // Clear existing content

                const overallDiv = document.createElement('div');
                overallDiv.innerHTML = `<h2>Overall Attendance: ${overallAttendance}</h2>`;
                contentDiv.appendChild(overallDiv);

                if (subjects.length > 0) {
                    const table = document.createElement('table');
                    const headerRow = document.createElement('tr');
                    headerRow.innerHTML = `
                        <th>Subject</th>
                        <th>Attendance</th>
                    `;
                    table.appendChild(headerRow);

                    subjects.forEach(({ subject, attendance }) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${subject}</td>
                            <td>${attendance}</td>
                        `;
                        table.appendChild(row);
                    });

                    contentDiv.appendChild(table);
                } else {
                    const noDataDiv = document.createElement('div');
                    noDataDiv.textContent = "No subject-wise data found.";
                    contentDiv.appendChild(noDataDiv);
                }

                // Show the buttons after the content is loaded
                backButton.classList.remove('hidden');
                cieButton.classList.remove('hidden');
            } catch (error) {
                console.error("Error fetching attendance:", error);
                contentDiv.textContent = "Incorrect Number, Go back and enter your parent's number";
            }
        }

        fetchName(); // Fetch name on page load
        fetchAttendance(); // Fetch attendance data
        
        

    </script>
    
    <!-- Footer HTML -->
<div id="footer">
    <p>Designed by <strong><a href="https://www.instagram.com/vardn.19" target="_blank">Vardan</a></strong></p>
</div>

<!-- Footer CSS -->
<style>
    /* Footer styling */
   /* Footer styling */
#footer {
    position: relative; /* Change from fixed to relative */
   
    width: 100%;
    text-align: center;
    font-size: 14px;
    color: #333; /* Dark gray color for text */
    padding: 10px 0;
    margin-top: 20px; /* Add space above the footer */
}

/* Styling for the strong tag (Vardan's name) */
#footer strong {
    color: #007BFF; /* Blue color for emphasis */
}

/* Styling for the link */
#footer a {
    color: #007BFF; /* Blue color for link */
    text-decoration: none;
    font-weight: bold;
}

#footer a:hover {
    text-decoration: underline; /* Underline on hover */
}

</style>

</body>
</html>
